{% extends 'base.html' %}

{% block title %}Edit Profile{% if site_settings.add_site_name_to_title %} - {{ site_settings.site_name }}{% endif %}{% endblock %}

{% block content %}
<div class="profile-edit-container">
    <h1>Edit Profile</h1>
    
    <!-- Profile edit form -->
    <div class="profile-edit-section">
        <h2>Basic Information</h2>
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="edit_profile" value="1">
            
            <div class="form-group">
                <label for="{{ profile_form.username.id_for_label }}">{{ profile_form.username.label }}</label>
                {{ profile_form.username }}
                {% if profile_form.username.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.username.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ profile_form.first_name.id_for_label }}">{{ profile_form.first_name.label }}</label>
                    {{ profile_form.first_name }}
                    {% if profile_form.first_name.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.first_name.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ profile_form.last_name.id_for_label }}">{{ profile_form.last_name.label }}</label>
                    {{ profile_form.last_name }}
                    {% if profile_form.last_name.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.last_name.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.avatar.id_for_label }}">{{ profile_form.avatar.label }}</label>
                {{ profile_form.avatar }}
                {% if profile_user.avatar %}
                    <div class="current-avatar">
                        <img src="{{ profile_user.avatar.url }}" alt="Current avatar">
                    </div>
                {% endif %}
                {% if profile_form.avatar.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.avatar.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.birth_date.id_for_label }}">{{ profile_form.birth_date.label }}</label>
                {{ profile_form.birth_date }}
                {% if profile_form.birth_date.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.birth_date.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ profile_form.gender.id_for_label }}">{{ profile_form.gender.label }}</label>
                    {{ profile_form.gender }}
                    {% if profile_form.gender.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.gender.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ profile_form.country.id_for_label }}">{{ profile_form.country.label }}</label>
                    {{ profile_form.country }}
                    {% if profile_form.country.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.country.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.location.id_for_label }}">{{ profile_form.location.label }}</label>
                {{ profile_form.location }}
                {% if profile_form.location.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.location.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ profile_form.marital_status.id_for_label }}">{{ profile_form.marital_status.label }}</label>
                    {{ profile_form.marital_status }}
                    {% if profile_form.marital_status.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.marital_status.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ profile_form.orientation.id_for_label }}">{{ profile_form.orientation.label }}</label>
                    {{ profile_form.orientation }}
                    {% if profile_form.orientation.errors %}
                        <div class="form-errors">
                            {% for error in profile_form.orientation.errors %}
                                <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.website.id_for_label }}">{{ profile_form.website.label }}</label>
                {{ profile_form.website }}
                {% if profile_form.website.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.website.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.education.id_for_label }}">{{ profile_form.education.label }}</label>
                {{ profile_form.education }}
                {% if profile_form.education.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.education.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ profile_form.bio.id_for_label }}">{{ profile_form.bio.label }}</label>
                {{ profile_form.bio }}
                {% if profile_form.bio.errors %}
                    <div class="form-errors">
                        {% for error in profile_form.bio.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn--primary">Save Changes</button>
                <a href="{% url 'members:profile' username=profile_user.username %}" class="btn btn--secondary">Cancel</a>
            </div>
        </form>
    </div>
    
    <!-- Password change form -->
    <div class="password-change-section">
        <h2>Change Password</h2>
        
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="change_password" value="1">
            
            <div class="form-group">
                <label for="{{ password_form.old_password.id_for_label }}">{{ password_form.old_password.label }}</label>
                {{ password_form.old_password }}
                {% if password_form.old_password.errors %}
                    <div class="form-errors">
                        {% for error in password_form.old_password.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ password_form.new_password1.id_for_label }}">{{ password_form.new_password1.label }}</label>
                {{ password_form.new_password1 }}
                {% if password_form.new_password1.errors %}
                    <div class="form-errors">
                        {% for error in password_form.new_password1.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
                <small class="form-text">Minimum 8 characters</small>
            </div>
            
            <div class="form-group">
                <label for="{{ password_form.new_password2.id_for_label }}">{{ password_form.new_password2.label }}</label>
                {{ password_form.new_password2 }}
                {% if password_form.new_password2.errors %}
                    <div class="form-errors">
                        {% for error in password_form.new_password2.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn--primary">Change Password</button>
            </div>
        </form>
    </div>
    
    <!-- Password reset link -->
    <div class="password-reset-section">
        <h2>Password Recovery</h2>
        <p>If you forgot your password, you can recover it via email.</p>
        <a href="{% url 'users:password_reset' %}" class="btn btn--secondary">Reset Password</a>
    </div>
</div>

{% endblock %}

