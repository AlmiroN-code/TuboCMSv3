{% extends 'base.html' %}
{% load core_tags %}

{% block title %}Мои плейлисты - {{ block.super }}{% endblock %}

{% block content %}
<div class="playlists-container">
    <div class="page-header">
        <h1><i class="fas fa-list"></i> Мои плейлисты</h1>
        <div class="header-actions">
            <a href="{% url 'videos:playlist_create' %}" class="btn btn--primary">
                <i class="fas fa-plus"></i> Создать плейлист
            </a>
        </div>
    </div>

    {% if playlists %}
        <div class="playlists-grid">
            {% for playlist in playlists %}
                <div class="playlist-card">
                    <div class="playlist-thumbnail">
                        <a href="{% url 'videos:playlist_detail' playlist_id=playlist.id %}">
                            {% if playlist.display_thumbnail %}
                                <img src="{{ playlist.display_thumbnail.url }}" alt="{{ playlist.title }}" loading="lazy">
                            {% else %}
                                <div class="playlist-placeholder">
                                    <i class="fas fa-list"></i>
                                    <span>{{ playlist.videos_count }}</span>
                                </div>
                            {% endif %}
                        </a>
                        
                        <div class="playlist-overlay">
                            <div class="video-count">
                                <i class="fas fa-play"></i>
                                {{ playlist.videos_count }} видео
                            </div>
                        </div>
                        
                        <div class="playlist-privacy">
                            {% if playlist.privacy == 'private' %}
                                <i class="fas fa-lock" title="Приватный"></i>
                            {% elif playlist.privacy == 'unlisted' %}
                                <i class="fas fa-eye-slash" title="Скрытый"></i>
                            {% else %}
                                <i class="fas fa-globe" title="Публичный"></i>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="playlist-info">
                        <h3 class="playlist-title">
                            <a href="{% url 'videos:playlist_detail' playlist_id=playlist.id %}">
                                {{ playlist.title }}
                            </a>
                        </h3>
                        
                        {% if playlist.description %}
                            <p class="playlist-description">{{ playlist.description|truncatechars:100 }}</p>
                        {% endif %}
                        
                        <div class="playlist-meta">
                            <span>{{ playlist.videos_count }} видео</span>
                            <span>{{ playlist.likes_count }} лайков</span>
                            <span>{{ playlist.created_at|time_ago }}</span>
                        </div>
                        
                        <div class="playlist-actions">
                            <a href="{% url 'videos:playlist_edit' playlist_id=playlist.id %}" 
                               class="btn btn--outline btn--sm">
                                <i class="fas fa-edit"></i> Редактировать
                            </a>
                            <button class="btn btn--primary btn--sm" 
                                    onclick="deletePlaylist({{ playlist.id }}, '{{ playlist.title|escapejs }}')">
                                <i class="fas fa-trash"></i> Удалить
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-content">
            <i class="fas fa-list"></i>
            <h3>У вас нет плейлистов</h3>
            <p>Создайте свой первый плейлист, чтобы организовать видео по темам</p>
            <a href="{% url 'videos:playlist_create' %}" class="btn btn--primary">
                <i class="fas fa-plus"></i> Создать плейлист
            </a>
        </div>
    {% endif %}
</div>

<!-- Delete confirmation modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Удалить плейлист</h3>
        <p>Вы уверены, что хотите удалить плейлист "<span id="playlistName"></span>"?</p>
        <div class="modal-actions">
            <button class="btn btn--outline" onclick="closeDeleteModal()">Отмена</button>
            <form id="deleteForm" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn--primary">Удалить</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}


{% block extra_js %}
<script>
function deletePlaylist(playlistId, playlistTitle) {
    document.getElementById('playlistName').textContent = playlistTitle;
    document.getElementById('deleteForm').action = `/videos/playlists/${playlistId}/delete/`;
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Close modal on outside click
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
{% endblock %}