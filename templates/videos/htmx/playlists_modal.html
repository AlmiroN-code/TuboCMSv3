{% load core_tags %}

<div class="playlist-modal">
    <h3><i class="fas fa-plus"></i> Добавить в плейлист</h3>
    
    <div class="video-info-mini">
        <strong>{{ video.title|truncatechars:50 }}</strong>
    </div>
    
    {% if playlists %}
        <div class="playlist-list">
            {% for playlist in playlists %}
                <div class="playlist-item">
                    <div class="playlist-info">
                        <h4>{{ playlist.title }}</h4>
                        <p>{{ playlist.videos_count }} видео • {{ playlist.get_privacy_display }}</p>
                    </div>
                    
                    <div class="playlist-action">
                        {% if playlist.has_video > 0 %}
                            <button class="btn btn--outline btn--sm" disabled>
                                <i class="fas fa-check"></i> Добавлено
                            </button>
                        {% else %}
                            <button class="btn btn--primary btn--sm" 
                                    hx-post="{% url 'videos:add_to_playlist' video_id=video.id %}"
                                    hx-vals='{"playlist_id": "{{ playlist.id }}"}' 
                                    hx-swap="none"
                                    onclick="this.innerHTML='<i class=\"fas fa-spinner fa-spin\"></i>'; this.disabled=true;">
                                <i class="fas fa-plus"></i> Добавить
                            </button>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-playlists">
            <p>У вас пока нет плейлистов</p>
        </div>
    {% endif %}
    
    <div class="modal-actions">
        <a href="{% url 'videos:playlist_create' %}?video_id={{ video.id }}" class="btn btn--outline">
            <i class="fas fa-plus"></i> Создать новый плейлист
        </a>
        <button class="btn btn--secondary close-modal" onclick="closeModal()">
            <i class="fas fa-times"></i> Закрыть
        </button>
    </div>
</div>

<script>
function closeModal() {
    document.getElementById('modal-container').innerHTML = '';
}

// Close modal on outside click
document.getElementById('modal-container').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeModal();
    }
});
</script>